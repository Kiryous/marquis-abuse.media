"use strict";function handleFileSelect(e){for(var t,n=e.target.files,i=0;t=n[i];i++)if(t.type.match("image.*")){var a=new FileReader;a.onload=function(e){return function(e){setBackgroundImage(e.target.result)}}(t),a.readAsDataURL(t)}}function createImage(){var e="image-debug",t=document.getElementById(e),n=t.getContext("2d"),i=document.getElementById("cover"),a=(document.getElementById("text"),document.getElementById("title")),l=window.backgroundImage,g=document.getElementById("bg-position").value,o=document.getElementById("title-font-family").value,d=document.getElementById("title-font-size").value,c=document.getElementById("title-font-weight").value,r=c+" "+d+"px "+o,m="750";document.getElementById(e).style.display="block",t.height=i.offsetHeight,t.width=i.offsetWidth;var u=t.width/l.width,s=t.height/l.height,h=u>s?u:s,y=l.width*h,f=l.height*h;n.drawImage(l,0,.01*-g*(f-t.offsetHeight),y,f),n.rect(0,0,t.width,t.height),n.fillStyle="rgba(0,0,0,0.6)",n.fill(),n.font=r,n.fillStyle="rgba(255, 255, 255, 1)",n.textAlign="center",wrapText(n,a.value,485,a.clientHeight+85,m,1.618*d),n.font="32px Permian Sans",n.fillStyle="rgba(255, 255, 255, 0.2)",n.textAlign="center",n.fillText("abuse.media",480,442)}function changeBgPosition(e){document.getElementById("cover").style.backgroundPosition="center "+e+"%",createImage()}function downloadImg(e,t){var n=document.getElementById(t),i=document.getElementById("title"),a=transLit(i.value.slice(0,15))+"(quote)â€¦.png";e.href=n.toDataURL("image/png"),e.download=a}function showPreview(e){var t=document.getElementById("image-debug");createImage(),"hidden"!=t.style.visibility&&t.style.visibility?"visible"==t.style.visibility&&(t.style.visibility="hidden",e.className="button"):(t.style.visibility="visible",e.className="button button_selected")}function setBackgroundImage(e){var t=document.getElementById("cover");t.style.backgroundImage="url("+e+")",window.backgroundImage=new Image,window.backgroundImage.src=e,window.backgroundImage.onload=function(){createImage()}}function transLit(e,t){var n='a b v g d e ["zh","j"] z i y k l m n o p r s t u f h c ch sh ["shh","shch"] ~ y ~ e yu ya ~ ["jo","e"]'.split(" "),i="",a="";e=e.toLowerCase().replace(/ /g,"-");for(var l=0;l<e.length;++l){var g=e.charCodeAt(l);a=g>=1072?n[g-1072]:e[l],i+=a}return i.replace(/[^a-zA-Z0-9\-]/g,"-").replace(/[-]{2,}/gim,"-").replace(/^\-+/g,"").replace(/\-+$/g,"")}function wrapText(e,t,n,i,a,l){for(var g=t.split(" "),o="",d=0;d<g.length;d++){var c=o+g[d]+" ",r=e.measureText(c),m=r.width;m>a&&d>0?(e.fillText(o,n,i),o=g[d]+" ",i+=l):o=c}e.fillText(o,n,i)}setBackgroundImage("assets/img/lighthouse.jpg"),document.getElementById("files").addEventListener("change",handleFileSelect,!1),document.getElementById("imageUrl").addEventListener("change",function(e){var t=e.target.value;setBackgroundImage(t)},!1),document.getElementById("title").addEventListener("change",createImage,!1),document.getElementById("bg-position").addEventListener("input",function(e){var t=e.target.value;changeBgPosition(t)},!1),document.getElementById("download-button").addEventListener("click",function(e){var t=e.target;downloadImg(t,"image-debug")},!1);