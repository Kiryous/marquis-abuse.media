"use strict";function handleFileSelect(e){for(var t,n=e.target.files,a=0;t=n[a];a++)if(t.type.match("image.*")){var i=new FileReader;i.onload=function(e){return function(e){setBackgroundImage(e.target.result)}}(t),i.readAsDataURL(t)}}function createImage(){var e="image-debug",t=document.getElementById(e),n=t.getContext("2d"),a=document.getElementById("cover"),i=(document.getElementById("text"),document.getElementById("title")),l=window.backgroundImage,o=document.getElementById("bg-position").value,d=document.getElementById("title-font-family").value,g=document.getElementById("title-font-size").value,c=document.getElementById("title-font-weight").value,r=c+" "+g+"px "+d,m="750";document.getElementById(e).style.display="block",t.height=a.offsetHeight,t.width=a.offsetWidth;var u=t.width/l.width,s=t.height/l.height,h=u>s?u:s,y=l.width*h,f=l.height*h;n.drawImage(l,0,.01*-o*(f-t.offsetHeight),y,f),n.rect(0,0,t.width,t.height),n.fillStyle="rgba(0,0,0,0.6)",n.fill(),n.font=r,n.fillStyle="rgba(255, 255, 255, 1)",n.textAlign="center",wrapText(n,i.value,485,151,m,1.25*g),n.font="32px Permian Sans",n.fillStyle="rgba(255, 255, 255, 0.2)",n.textAlign="center",n.fillText("abuse.media",480,442)}function changeBgPosition(e){document.getElementById("cover").style.backgroundPosition="center "+e+"%",createImage()}function downloadImg(e,t){var n=document.getElementById(t),a=document.getElementById("title"),i=transLit(a.value.slice(0,15))+"(quote)â€¦.png";e.href=n.toDataURL("image/png"),e.download=i}function showPreview(e){var t=document.getElementById("image-debug");createImage(),"hidden"!=t.style.visibility&&t.style.visibility?"visible"==t.style.visibility&&(t.style.visibility="hidden",e.className="button"):(t.style.visibility="visible",e.className="button button_selected")}function setBackgroundImage(e){var t=document.getElementById("cover");t.style.backgroundImage="url("+e+")",window.backgroundImage=new Image,window.backgroundImage.src=e,window.backgroundImage.onload=function(){createImage()}}function transLit(e,t){var n='a b v g d e ["zh","j"] z i y k l m n o p r s t u f h c ch sh ["shh","shch"] ~ y ~ e yu ya ~ ["jo","e"]'.split(" "),a="",i="";e=e.toLowerCase().replace(/ /g,"-");for(var l=0;l<e.length;++l){var o=e.charCodeAt(l);i=o>=1072?n[o-1072]:e[l],a+=i}return a.replace(/[^a-zA-Z0-9\-]/g,"-").replace(/[-]{2,}/gim,"-").replace(/^\-+/g,"").replace(/\-+$/g,"")}function wrapText(e,t,n,a,i,l){for(var o=t.split(" "),d="",g=0;g<o.length;g++){var c=d+o[g]+" ",r=e.measureText(c),m=r.width;m>i&&g>0?(e.fillText(d,n,a),d=o[g]+" ",a+=l):d=c}e.fillText(d,n,a)}setBackgroundImage("assets/img/lighthouse.jpg"),document.getElementById("files").addEventListener("change",handleFileSelect,!1),document.getElementById("imageUrl").addEventListener("change",function(e){var t=e.target.value;setBackgroundImage(t)},!1),document.getElementById("title").addEventListener("change",createImage,!1),document.getElementById("bg-position").addEventListener("input",function(e){var t=e.target.value;changeBgPosition(t)},!1),document.getElementById("download-button").addEventListener("click",function(e){var t=e.target;downloadImg(t,"image-debug")},!1);