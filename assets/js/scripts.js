"use strict";function handleFileSelect(e){for(var t,n=e.target.files,i=document.getElementById("cover"),a=0;t=n[a];a++)if(t.type.match("image.*")){var l=new FileReader;l.onload=function(e){return function(e){i.style.backgroundImage="url("+e.target.result+")";var t=document.getElementById("background-image");t.src=e.target.result}}(t),l.readAsDataURL(t)}setTimeout(createImage,100)}function createImage(){var e="image-debug",t=document.getElementById(e),n=t.getContext("2d"),i=document.getElementById("cover"),a=(document.getElementById("text"),document.getElementById("title")),l=document.getElementById("background-image"),g=document.getElementById("bg-position").value,o=document.getElementById("title-font-family").value,c=document.getElementById("title-font-size").value,d=document.getElementById("title-font-weight").value,r=d+" "+c+"px "+o,m="750";document.getElementById(e).style.display="block",t.height=i.offsetHeight,t.width=i.offsetWidth;var u=t.width/l.clientWidth,s=t.height/l.clientHeight,h=u>s?u:s,y=l.width*h,f=l.height*h;n.drawImage(l,0,.01*-g*(f-t.offsetHeight),y,f),n.rect(0,0,t.width,t.height),n.fillStyle="rgba(0,0,0,0.6)",n.fill(),n.font=r,n.fillStyle="rgba(255, 255, 255, 1)",n.textAlign="center",wrapText(n,a.value,485,a.clientHeight+85,m,1.618*c),n.font="32px Permian Sans",n.fillStyle="rgba(255, 255, 255, 0.2)",n.textAlign="center",n.fillText("abuse.media",480,442)}function changeBg(e){document.getElementById("cover").style.backgroundImage="url("+e+")",document.getElementById("background-image").src=e,setTimeout(createImage,100)}function changeBgPosition(e){document.getElementById("cover").style.backgroundPosition="center "+e+"%",createImage()}function downloadImg(e,t){var n=document.getElementById(t),i=document.getElementById("title"),a=transLit(i.value.slice(0,15))+"(quote)â€¦.png";e.href=n.toDataURL("image/png"),e.download=a}function showPreview(e){var t=document.getElementById("image-debug");createImage(),"hidden"!=t.style.visibility&&t.style.visibility?"visible"==t.style.visibility&&(t.style.visibility="hidden",e.className="button"):(t.style.visibility="visible",e.className="button button_selected")}function transLit(e,t){var n='a b v g d e ["zh","j"] z i y k l m n o p r s t u f h c ch sh ["shh","shch"] ~ y ~ e yu ya ~ ["jo","e"]'.split(" "),i="",a="";e=e.toLowerCase().replace(/ /g,"-");for(var l=0;l<e.length;++l){var g=e.charCodeAt(l);a=g>=1072?n[g-1072]:e[l],i+=a}return i.replace(/[^a-zA-Z0-9\-]/g,"-").replace(/[-]{2,}/gim,"-").replace(/^\-+/g,"").replace(/\-+$/g,"")}function wrapText(e,t,n,i,a,l){for(var g=t.split(" "),o="",c=0;c<g.length;c++){var d=o+g[c]+" ",r=e.measureText(d),m=r.width;m>a&&c>0?(e.fillText(o,n,i),o=g[c]+" ",i+=l):o=d}e.fillText(o,n,i)}$("#bg-position").on("input",function(e){var t=e.target.value;changeBgPosition(t)}),$("#imageUrl").on("change",function(e){var t=e.target.value;changeBg(t)}),$("#download-button").on("click",function(e){var t=e.target;downloadImg(t,"image-debug")}),document.getElementById("files").addEventListener("change",handleFileSelect,!1),document.getElementById("title").addEventListener("change",createImage,!1),document.getElementById("bg-position").addEventListener("change",changeBgPosition,!1);