"use strict";function wrapText(e,t,n,i,l,a){for(var o=t.split(" "),c="",g=0;g<o.length;g++){var d=c+o[g]+" ",m=e.measureText(d),r=m.width;r>l&&g>0?(e.fillText(c,n,i),c=o[g]+" ",i+=a):c=d}e.fillText(c,n,i)}function createImage(){var e="image-debug",t=document.getElementById(e),n=t.getContext("2d"),i=document.getElementById("cover"),l=(document.getElementById("text"),document.getElementById("title")),a=document.getElementById("background-image"),o=document.getElementById("bg-position").value,c=document.getElementById("title-font-family").value,g=document.getElementById("title-font-size").value,d=document.getElementById("title-font-weight").value,m=d+" "+g+"px "+c,r="750";document.getElementById(e).style.display="block",t.height=i.offsetHeight,t.width=i.offsetWidth;var u=t.width/a.clientWidth,s=t.height/a.clientHeight,y=u>s?u:s,h=a.width*y,f=a.height*y;n.drawImage(a,0,.01*-o*(f-t.offsetHeight),h,f),n.rect(0,0,t.width,t.height),n.fillStyle="rgba(0,0,0,0.6)",n.fill(),n.font=m,n.fillStyle="rgba(255, 255, 255, 1)",n.textAlign="center",wrapText(n,l.value,485,l.clientHeight+85,r,1.618*g),n.font="24px Permian Sans",n.fillStyle="rgba(255, 255, 255, 0.2)",n.textAlign="center",n.fillText("abuse.media",480,448)}function handleFileSelect(e){for(var t,n=e.target.files,i=document.getElementById("cover"),l=0;t=n[l];l++)if(t.type.match("image.*")){var a=new FileReader;a.onload=function(e){return function(e){i.style.backgroundImage="url("+e.target.result+")";var t=document.getElementById("background-image");t.src=e.target.result}}(t),a.readAsDataURL(t)}setTimeout(createImage,100)}function changeBg(e){document.getElementById("cover").style.backgroundImage="url("+e+")",document.getElementById("background-image").src=e,setTimeout(createImage,100)}function changeBgPosition(e){document.getElementById("cover").style.backgroundPosition="center "+e+"%",createImage()}function transLit(e,t){var n='a b v g d e ["zh","j"] z i y k l m n o p r s t u f h c ch sh ["shh","shch"] ~ y ~ e yu ya ~ ["jo","e"]'.split(" "),l="",a="";for(e=e.toLowerCase().replace(/ /g,"-"),i=0;i<e.length;++i)cc=e.charCodeAt(i),a=cc>=1072?n[cc-1072]:e[i],l+=a;return l.replace(/[^a-zA-Z0-9\-]/g,"-").replace(/[-]{2,}/gim,"-").replace(/^\-+/g,"").replace(/\-+$/g,"")}function downloadImg(e,t){var n=document.getElementById(t),i=(document.getElementById("quotation"),document.getElementById("quote")),l=document.getElementById("author"),a=transLit(l.value)+"--"+transLit(i.value.slice(0,15))+"(quote)â€¦.png";e.href=n.toDataURL("image/png"),e.download=a}function showPreview(e){var t=document.getElementById("image-debug");createImage(),console.log(t.style.visibility),"hidden"==t.style.visibility|""==t.style.visibility?(t.style.visibility="visible",e.className="button button_selected"):"visible"==t.style.visibility&&(t.style.visibility="hidden",e.className="button")}document.getElementById("files").addEventListener("change",handleFileSelect,!1),document.getElementById("title").addEventListener("change",createImage,!1),document.getElementById("bg-position").addEventListener("change",changeBgPosition,!1);